# Загрузка данных в файловую систему МК - Arduino IDE 1.8.19

1. Скачайте плагин для работы с файловой системой микроконтроллера из Arduino IDE

- Для микроконтроллера **ESP8266**
https://github.com/earlephilhower/arduino-esp8266littlefs-plugin

- Для микроконтроллера **ESP32**
https://github.com/lorol/arduino-esp32littlefs-plugin  
или более новый, универсальный, с поддержкой нескольких файловых систем    
https://github.com/lorol/arduino-esp32fs-plugin


**Внимание!!!**  
Не нужно скачивать исходные коды этих плагинов и копировать их в папку установки!!!  
В указанных репозиториях в описании найдите секцию **Installation** и в ней ссылку на скачивание актуальной версии плагинов.

![image](https://user-images.githubusercontent.com/39353139/233008476-f82440a8-7116-4e65-8439-7551d454701b.png)

Эти же плагины (возможно не самой актуальной версии (но рабочие) лежат в папке tools/LittleFS проекта - 
если не можете разобраться как скачать и установить из описания в репозитории - возьмите их из указанной папке проекта и 
переходите к пункту 2 этой инструкции.

2. Установите плагин в Arduino IDE:  
 a. Перейдите в папку, где установлена Arduino IDE (обычно `"C:\Program Files (x86)\Arduino\"`)  
 b. Если в папке нет подпапки **tools** - создайте ее, если есть - перейдите в эту папку  
 с. Распакуйте архив **ESP8266LittleFS-2.6.0.zip** для ***ESP8266*** или **ESP32LittleFS.zip** для ***ESP32*** в папку tools - 
    в ней будет создана соответствующая подпапка **ESP8266LittleFS** или **ESP32LittleFS** с файлами плагина  
 d. Перезагрузите Arduino IDE  

3. В папке скетча создайте подпапку **data**

# Загрузка данных в файловую систему МК - Arduino IDE 2.3.x

1. Скачайте последнюю версию плагина для работы с файловой системой микроконтроллера из Arduino IDE

   https://github.com/earlephilhower/arduino-littlefs-upload/releases/

![image](https://github.com/user-attachments/assets/bd05a24b-b52d-4b67-ad21-1beafb072bb0)

Эти же плагины (возможно не самой актуальной версии (но рабочие) лежат в папке tools/LittleFS проекта - 
если не можете разобраться как скачать и установить из описания в репозитории - возьмите их из указанной папке проекта и 
переходите к пункту 2 этой инструкции.

2. В папке скетча создайте подпапку **data**

3. Установите плагин в Arduino IDE:  
 a. Перейдите в папку хранилища плагинов IDE - `"C:\Users\<username>\.arduinoIDE\plugins\"`) и скопируйте скачанный плагин в эту папку 
 b. Запустите Arduino IDE 2.3.x, нажмите одновременно [Ctrl] + [Shift] + [P], 
   затем выберите в появившемся меню "Upload LittleFS to Pico/ESP8266/Esp32".
   Начните печатать в строке поиска 'Upload' и фильтр поможет найти плагин

   Если у вас открыт монитор порта - закройте его, иначе может возникнуть конфликт - плагин загрузки файла скажет, что порт занять и к нему нет доступа.

## Загрузка файлов картинок 

4. В созданной папке data создайте подпапку с именем, соответствующим размерам вашей матрицы. 
   Например для матрицы **16x16** создайте папку **16p16**

5. В созданную папку **16р16** скопируйте файлы картинок из папки **pics/16p16** проекта

## Загрузка роликов из Jinx!

6. Для матрицы 16x16 подготовлены демо-ролики, которые находятся в папке **16x16". Это файлы с расширением \*.out
   Если вы подготовили собственные ролики в редакторе Jinx! для матрицы вашего размера - создайте папку с именем,
   соответствующим по шаблону **WxH** размерам вашей матрицы, где **W** - ширина матрицы, **H** - высота матрицы.
   Загрузите ролики в созданную папку.

   **Внимание!!!** размер свободного пространства в файловой системе микроконтроллера обычно не превышает 2 мегабайт.
   Размер ролика из Jinx! занимает значительный объем (зависит от размера матрицы и количества кадров). Следите за тем, чтобы
   размер ролика не превышал свободного места в файловой системе, иначе процесс загрузки файлов завершится с ошибкой.

## Загрузка файлов Web-интерфейса

7. Подготовленные файлы текущей версии веб-интерфейса находятся в папке **data/web**.
   Если у вас есть обновленная версия Web-интерфейса или вы загружаете новый языковой файл - поместите
   новые файлы в структуру этой папки.

## Загрузка файлов карт индексов

8. Если вы используете способ адресации светодиодов в матрице через карту индексов - поместите созданные файлы карт в папку **data**

## Прочие файлы

9. Если требуется загрузить в файловую систему микроконтроллера какие-то дополнительный файлы - поместите их в папку **data** 
   подготовленной прошивки, соблюдая требуемую структуру. Следите, чтобы общий размер всех файлов в папке **data** не превышал размера
   выделенного под файловую систему в настройках Arduino IDE в меню "Инструменты".

## Запуск процесса загрузки

10. В Arduino IDE в меню **"Инструменты"** выберите пункт **"ESP8266 LittleFS Data Upload"** для плат на базе микроконтроллера ESP8266 
    или **"ESP32 LittleFS Data Upload"** для плат на основе микроконтроллера ESP32

11. Наблюдайте в ArduinoIDE области сообщений ход загрузки файлов, дождитесь сообщения о завершении загрузке и
    о перезагрузке микроконтроллера

12. Загрузка файлов завершена.

# Внимание!!!

Загрузка файлов в файловую систему микроконтроллера сопровождается удалением всего содержимого, ранее хранившегося в файловой системе,
переразметкой разделов и последующей загрузкой новых файлов из папки data.

Соответственно всё, то ранее хранилось в файловой системе, будет утеряно.  

В файловой системе хранятся следующие объекты:
- Web-интерфейс приложения
- Настройки подключения к локальной сети - имя сети, пароль, IP адрес присваиваемый устройству.
- Настройки содержимого строк для "Бегущей строки"
- Картинки, нарисованные пользователем в разделе "Рисование".
- Сохраненные в программе резервные копии настроек.

Все это будет утеряно при выполнении процесса загрузки содержимого папки **data** в файловую систему микроконтроллера. 
После завершения процесса загрузки микроконтроллер автоматически перезагрузится и создаст точку доступа PanelAP с
сетевым локальным адресом 192.168.4.1 и паролем по умолчанию - *12341234*.
